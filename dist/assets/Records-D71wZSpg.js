import{d as X,n as se,t as W,u as le,a as Xe,b as ie,c as s,r as _,e as Ze,f as M,g as J,w as et,H as tt,m as we,h as j,i as Z,j as at,k as pe,l as ot,T as nt,o as xe,p as st,q as lt,s as it,v as ut,x as rt,y as dt,I as be,z as ee,A as Q,B as ct,C as Te,D as ke,E as vt,F as mt,G as ft,J as E,K as f,L as x,M as Y,N as ge,O as F,P as G,Q as ae,R as oe,S as he,U as _e,V as $,W as pt}from"./index-Benjlr5I.js";import{B as gt,s as ye,a as ne,D as ht}from"./index-BgStsiB7.js";import{u as ue,P as Ce,C as De,L as re,a as _t,_ as yt,b as wt,c as xt,d as z,N as bt,e as Tt}from"./_plugin-vue_export-helper-CSfwAwDO.js";import{u as kt,E as Ct,D as Dt,T as St}from"./index-dhnJgP5T.js";import{F as Pt,R as Vt,a as It,S as Rt}from"./index-B7ULETM9.js";import{u as Yt}from"./use-id-BsUR0Dcz.js";import"./index-BNpv-Ijv.js";const[Se,q]=Z("dropdown-menu"),$t={overlay:W,zIndex:se,duration:j(.2),direction:we("down"),activeColor:String,autoLocate:Boolean,closeOnClickOutside:W,closeOnClickOverlay:W,swipeThreshold:se},Pe=Symbol(Se);var Ot=X({name:Se,props:$t,setup(t,{slots:v}){const u=Yt(),y=_(),d=_(),T=_(0),{children:p,linkChildren:c}=Ze(Pe),w=le(y),h=M(()=>p.some(n=>n.state.showWrapper)),S=M(()=>t.swipeThreshold&&p.length>+t.swipeThreshold),V=M(()=>{if(h.value&&at(t.zIndex))return{zIndex:+t.zIndex+1}}),b=()=>{p.forEach(n=>{n.toggle(!1)})},k=()=>{t.closeOnClickOutside&&b()},o=()=>{if(d.value){const n=J(d);t.direction==="down"?T.value=n.bottom:T.value=et.value-n.top}},C=()=>{h.value&&o()},D=n=>{p.forEach((g,a)=>{a===n?g.toggle():g.state.showPopup&&g.toggle(!1,{immediate:!0})})},I=(n,g)=>{const{showPopup:a}=n.state,{disabled:r,titleClass:P}=n;return s("div",{id:`${u}-${g}`,role:"button",tabindex:r?void 0:0,"data-allow-mismatch":"attribute",class:[q("item",{disabled:r,grow:S.value}),{[tt]:!r}],onClick:()=>{r||D(g)}},[s("span",{class:[q("title",{down:a===(t.direction==="down"),active:a}),P],style:{color:a?t.activeColor:""}},[s("div",{class:"van-ellipsis"},[n.renderTitle()])])])};return ue({close:b,opened:h}),c({id:u,props:t,offset:T,opened:h,updateOffset:o}),Xe(y,k),ie("scroll",C,{target:w,passive:!0}),()=>{var n;return s("div",{ref:y,class:q()},[s("div",{ref:d,style:V.value,class:q("bar",{opened:h.value,scrollable:S.value})},[p.map(I)]),(n=v.default)==null?void 0:n.call(v)])}}});const[Mt,K]=Z("dropdown-item"),Bt={title:String,options:dt(),disabled:Boolean,teleport:[String,Object],lazyRender:W,modelValue:pe,titleClass:pe};var Et=X({name:Mt,inheritAttrs:!1,props:Bt,emits:["open","opened","close","closed","change","update:modelValue"],setup(t,{emit:v,slots:u,attrs:y}){const d=xe({showPopup:!1,transition:!0,showWrapper:!1}),T=_(),{parent:p,index:c}=ot(Pe);if(!p)return;const w=n=>()=>v(n),h=w("open"),S=w("close"),V=w("opened"),b=()=>{d.showWrapper=!1,v("closed")},k=n=>{t.teleport&&n.stopPropagation()},o=(n=!d.showPopup,g={})=>{n!==d.showPopup&&(d.showPopup=n,d.transition=!g.immediate,n&&(p.updateOffset(),d.showWrapper=!0))},C=()=>{if(u.title)return u.title();if(t.title)return t.title;const n=t.options.find(g=>g.value===t.modelValue);return n?n.text:""},D=n=>{const{activeColor:g}=p.props,{disabled:a}=n,r=n.value===t.modelValue,P=()=>{a||(d.showPopup=!1,n.value!==t.modelValue&&(v("update:modelValue",n.value),v("change",n.value)))},B=()=>{if(r)return s(be,{class:K("icon"),color:a?void 0:g,name:"success"},null)};return s(De,{role:"menuitem",key:String(n.value),icon:n.icon,title:n.text,class:K("option",{active:r,disabled:a}),style:{color:r?g:""},tabindex:r?0:-1,clickable:!a,onClick:P},{value:B})},I=()=>{const{offset:n}=p,{autoLocate:g,zIndex:a,overlay:r,duration:P,direction:B,closeOnClickOverlay:te}=p.props,H=st(a);let N=n.value;if(g&&T.value){const O=lt(T.value);O&&(N-=J(O).top)}return B==="down"?H.top=`${N}px`:H.bottom=`${N}px`,it(s("div",rt({ref:T,style:H,class:K([B]),onClick:k},y),[s(Ce,{show:d.showPopup,"onUpdate:show":O=>d.showPopup=O,role:"menu",class:K("content"),overlay:r,overlayProps:{duration:d.transition&&!p.opened.value?P:0},position:B==="down"?"top":"bottom",duration:d.transition?P:0,lazyRender:t.lazyRender,overlayStyle:{position:"absolute"},"aria-labelledby":`${p.id}-${c.value}`,"data-allow-mismatch":"attribute",closeOnClickOverlay:te,onOpen:h,onClose:S,onOpened:V,onClosed:b},{default:()=>{var O;return[t.options.map(D),(O=u.default)==null?void 0:O.call(u)]}})]),[[ut,d.showWrapper]])};return ue({state:d,toggle:o,renderTitle:C}),()=>t.teleport?s(nt,{to:t.teleport},{default:()=>[I()]}):I()}});const zt=ee(Et),Ut=ee(Ot),[Ht,U,Nt]=Z("list"),At={error:Boolean,offset:j(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:we("down"),loadingText:{type:String,default:""},finishedText:String,immediateCheck:W};var Ft=X({name:Ht,props:At,emits:["load","update:error","update:loading"],setup(t,{emit:v,slots:u}){const y=_(t.loading),d=_(),T=_(),p=kt(),c=le(d),w=M(()=>t.scroller||c.value),h=()=>{ke(()=>{if(y.value||t.finished||t.disabled||t.error||p?.value===!1)return;const{direction:o}=t,C=+t.offset,D=J(w);if(!D.height||vt(d))return;let I=!1;const n=J(T);o==="up"?I=D.top-n.top<=C:I=n.bottom-D.bottom<=C,I&&(y.value=!0,v("update:loading",!0),v("load"))})},S=()=>{if(t.finished){const o=u.finished?u.finished():t.finishedText;if(o)return s("div",{class:U("finished-text")},[o])}},V=()=>{v("update:error",!1),h()},b=()=>{if(t.error){const o=u.error?u.error():t.errorText;if(o)return s("div",{role:"button",class:U("error-text"),tabindex:0,onClick:V},[o])}},k=()=>{if(y.value&&!t.finished&&!t.disabled)return s("div",{class:U("loading")},[u.loading?u.loading():t.loadingText!=null&&s(re,{class:U("loading-icon")},{default:()=>[t.loadingText||Nt("loading")]})])};return Q(()=>[t.loading,t.finished,t.error],h),p&&Q(p,o=>{o&&h()}),ct(()=>{y.value=t.loading}),Te(()=>{t.immediateCheck&&h()}),ue({check:h}),ie("scroll",h,{target:w,passive:!0}),()=>{var o;const C=(o=u.default)==null?void 0:o.call(u),D=s("div",{ref:T,class:U("placeholder")},null);return s("div",{ref:d,role:"feed",class:U(),"aria-busy":y.value},[t.direction==="down"?C:D,k(),S(),b(),t.direction==="up"?C:D])}}});const Lt=ee(Ft),[Wt,L,jt]=Z("pull-refresh"),Ve=50,Gt=["pulling","loosing","success"],qt={disabled:Boolean,modelValue:Boolean,headHeight:j(Ve),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:se,successDuration:j(500),animationDuration:j(300)};var Kt=X({name:Wt,props:qt,emits:["change","refresh","update:modelValue"],setup(t,{emit:v,slots:u}){let y;const d=_(),T=_(),p=le(d),c=xe({status:"normal",distance:0,duration:0}),w=_t(),h=()=>{if(t.headHeight!==Ve)return{height:`${t.headHeight}px`}},S=()=>c.status!=="loading"&&c.status!=="success"&&!t.disabled,V=a=>{const r=+(t.pullDistance||t.headHeight);return a>r&&(a<r*2?a=r+(a-r)/2:a=r*1.5+(a-r*2)/4),Math.round(a)},b=(a,r)=>{const P=+(t.pullDistance||t.headHeight);c.distance=a,r?c.status="loading":a===0?c.status="normal":a<P?c.status="pulling":c.status="loosing",v("change",{status:c.status,distance:a})},k=()=>{const{status:a}=c;return a==="normal"?"":t[`${a}Text`]||jt(a)},o=()=>{const{status:a,distance:r}=c;if(u[a])return u[a]({distance:r});const P=[];return Gt.includes(a)&&P.push(s("div",{class:L("text")},[k()])),a==="loading"&&P.push(s(re,{class:L("loading")},{default:k})),P},C=()=>{c.status="success",setTimeout(()=>{b(0)},+t.successDuration)},D=a=>{y=mt(p.value)===0,y&&(c.duration=0,w.start(a))},I=a=>{S()&&D(a)},n=a=>{if(S()){y||D(a);const{deltaY:r}=w;w.move(a),y&&r.value>=0&&w.isVertical()&&(ft(a),b(V(r.value)))}},g=()=>{y&&w.deltaY.value&&S()&&(c.duration=+t.animationDuration,c.status==="loosing"?(b(+t.headHeight,!0),v("update:modelValue",!0),ke(()=>v("refresh"))):b(0))};return Q(()=>t.modelValue,a=>{c.duration=+t.animationDuration,a?b(+t.headHeight,!0):u.success||t.successText?C():b(0,!1)}),ie("touchmove",n,{target:T}),()=>{var a;const r={transitionDuration:`${c.duration}ms`,transform:c.distance?`translate3d(0,${c.distance}px, 0)`:""};return s("div",{ref:d,class:L()},[s("div",{ref:T,class:L("track"),style:r,onTouchstartPassive:I,onTouchend:g,onTouchcancel:g},[s("div",{class:L("head"),style:h()},[o()]),(a=u.default)==null?void 0:a.call(u)])])}}});const Jt=ee(Kt),Qt={class:"records-page"},Xt={class:"month-selector"},Zt={class:"monthly-stats"},ea={class:"stat-item"},ta={class:"value expense"},aa={class:"stat-item"},oa={class:"value income"},na={class:"stat-item"},sa={key:0,class:"loading-container"},la={class:"group-header"},ia={class:"date"},ua={class:"total"},ra={key:0},da={class:"record-form"},ca={class:"tag-selector"},va={__name:"Records",setup(t){const v=wt(),u=xt(),y=_(!1),d=_(!1),T=_(!0),p=_(!0),c=_(!1),w=_(!1),h=_(!1),S=_(!1),V=_(null),b=_(null),k=_(z().format("YYYY-MM")),o=_({type:"expense",amount:"",date:z().format("YYYY-MM-DD"),tagIds:[],note:""}),C=_(["2024","01","01"]),D=new Date(2020,0,1),I=new Date(2030,11,31),n=M(()=>{if(!k.value)return v.records;const[l,e]=k.value.split("-").map(Number);return v.getRecordsByMonth(l,e)}),g=M(()=>{if(!k.value)return v.getStatistics();const[l,e]=k.value.split("-").map(Number),m=v.getRecordsByMonth(l,e);return v.getStatistics(m)}),a=M(()=>{const l=[{text:"全部",value:""}];for(let e=0;e<12;e++){const m=z().subtract(e,"month");l.push({text:m.format("YYYY年MM月"),value:m.format("YYYY-MM")})}return v.availableMonths.forEach(e=>{l.find(m=>m.value===e)||l.push({text:z(e).format("YYYY年MM月"),value:e})}),l}),r=M(()=>o.value.type==="expense"?u.expenseTags:o.value.type==="income"?u.incomeTags:u.tags),P=M(()=>{const l={};return n.value.forEach(e=>{const m=e.date;l[m]||(l[m]={date:m,records:[],expense:0,income:0}),l[m].records.push(e),e.type==="expense"?l[m].expense+=e.amount:l[m].income+=e.amount}),Object.values(l).sort((e,m)=>new Date(m.date).getTime()-new Date(e.date).getTime())}),B=["周日","周一","周二","周三","周四","周五","周六"],te=l=>{const e=z(l),m=z();return e.isSame(m,"day")?"今天":e.isSame(m.subtract(1,"day"),"day")?"昨天":e.format("MM月DD日")+" "+B[e.day()]},H=l=>{const e=u.getTagsByIds(l.tagIds);return e.length>0?e.map(m=>m.name).join("、"):"未分类"},N=l=>{const e=u.getTagsByIds(l.tagIds);return e.length>0?e[0].color:"#969799"},O=l=>{const e=u.getTagsByIds(l.tagIds);return e.length>0?e[0].name.charAt(0):"?"},Ie=l=>{const e=o.value.tagIds.indexOf(l);e>-1?o.value.tagIds.splice(e,1):o.value.tagIds.push(l)},Re=async()=>{await v.init(),d.value=!1},Ye=()=>{p.value=!0},$e=({selectedValues:l})=>{o.value.date=l.join("-"),h.value=!1},Oe=l=>{V.value=l,o.value={type:l.type,amount:String(l.amount),date:l.date,tagIds:[...l.tagIds||[]],note:l.note||""},C.value=l.date.split("-"),w.value=!0},de=()=>{w.value=!1,V.value=null,o.value={type:"expense",amount:"",date:z().format("YYYY-MM-DD"),tagIds:[],note:""}},Me=async()=>{if(!o.value.amount||Number(o.value.amount)<=0){ye("请输入有效金额");return}c.value=!0;try{const l={...o.value,amount:Number(o.value.amount)};V.value?(await v.updateRecord(V.value.id,l),ne("更新成功")):(await v.addRecord(l),ne("添加成功")),de()}catch{ye("保存失败")}finally{c.value=!1}},Be=l=>{b.value=l,S.value=!0},Ee=async()=>{b.value&&(await v.deleteRecord(b.value.id),ne("删除成功"),b.value=null)};return Q(()=>o.value.type,l=>{const e=r.value.map(m=>m.id);o.value.tagIds=o.value.tagIds.filter(m=>e.includes(m))}),Te(async()=>{T.value=!0,await Promise.all([v.init(),u.init()]),T.value=!1}),(l,e)=>{const m=be,ce=bt,ze=zt,Ue=Ut,He=re,Ne=De,ve=gt,Ae=Rt,Fe=Ct,Le=Lt,We=Jt,me=It,je=Vt,A=Pt,Ge=St,qe=Tt,fe=Ce,Ke=Dt,Je=ht;return $(),E("div",Qt,[s(ce,{title:"记账"},{right:f(()=>[s(m,{name:"plus",size:"20",onClick:e[0]||(e[0]=i=>w.value=!0)})]),_:1}),x("div",Xt,[s(Ue,null,{default:f(()=>[s(ze,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=i=>k.value=i),options:a.value},null,8,["modelValue","options"])]),_:1})]),x("div",Zt,[x("div",ea,[e[14]||(e[14]=x("span",{class:"label"},"支出",-1)),x("span",ta,"¥"+Y(g.value.expense.toFixed(2)),1)]),x("div",aa,[e[15]||(e[15]=x("span",{class:"label"},"收入",-1)),x("span",oa,"¥"+Y(g.value.income.toFixed(2)),1)]),x("div",na,[e[16]||(e[16]=x("span",{class:"label"},"结余",-1)),x("span",{class:ge(["value",{positive:g.value.balance>=0}])}," ¥"+Y(g.value.balance.toFixed(2)),3)])]),T.value?($(),E("div",sa,[s(He,{size:"24px"},{default:f(()=>[...e[17]||(e[17]=[F("加载中...",-1)])]),_:1})])):($(),G(We,{key:1,modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=i=>d.value=i),onRefresh:Re},{default:f(()=>[s(Le,{loading:y.value,"onUpdate:loading":e[2]||(e[2]=i=>y.value=i),finished:p.value,"finished-text":"没有更多了",onLoad:Ye},{default:f(()=>[($(!0),E(ae,null,oe(P.value,i=>($(),E("div",{key:i.date,class:"record-group"},[x("div",la,[x("span",ia,Y(te(i.date)),1),x("span",ua," 支: ¥"+Y(i.expense.toFixed(2))+" | 收: ¥"+Y(i.income.toFixed(2)),1)]),($(!0),E(ae,null,oe(i.records,R=>($(),G(Ae,{key:R.id},{right:f(()=>[s(ve,{square:"",type:"danger",text:"删除",onClick:Qe=>Be(R)},null,8,["onClick"])]),default:f(()=>[s(Ne,{title:H(R),"is-link":"",onClick:Qe=>Oe(R)},{icon:f(()=>[x("div",{class:"record-icon",style:pt({background:N(R)})},Y(O(R)),5)]),value:f(()=>[x("span",{class:ge(["amount",R.type])},Y(R.type==="expense"?"-":"+")+"¥"+Y(R.amount.toFixed(2)),3)]),label:f(()=>[R.note?($(),E("span",ra,Y(R.note),1)):he("",!0)]),_:2},1032,["title","onClick"])]),_:2},1024))),128))]))),128)),!y.value&&n.value.length===0?($(),G(Fe,{key:0,description:"暂无记账数据"})):he("",!0)]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])),s(fe,{show:w.value,"onUpdate:show":e[9]||(e[9]=i=>w.value=i),position:"bottom",style:{height:"80%"},round:""},{default:f(()=>[x("div",da,[s(ce,{title:V.value?"编辑记账":"添加记账"},{left:f(()=>[s(m,{name:"cross",size:"20",onClick:de})]),right:f(()=>[s(ve,{type:"primary",size:"small",loading:c.value,onClick:Me},{default:f(()=>[...e[18]||(e[18]=[F(" 保存 ",-1)])]),_:1},8,["loading"])]),_:1},8,["title"]),s(qe,{inset:""},{default:f(()=>[s(A,{label:"类型"},{input:f(()=>[s(je,{modelValue:o.value.type,"onUpdate:modelValue":e[4]||(e[4]=i=>o.value.type=i),direction:"horizontal"},{default:f(()=>[s(me,{name:"expense"},{default:f(()=>[...e[19]||(e[19]=[F("支出",-1)])]),_:1}),s(me,{name:"income"},{default:f(()=>[...e[20]||(e[20]=[F("收入",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(A,{modelValue:o.value.amount,"onUpdate:modelValue":e[5]||(e[5]=i=>o.value.amount=i),type:"number",label:"金额",placeholder:"请输入金额",rules:[{required:!0,message:"请输入金额"}]},{button:f(()=>[...e[21]||(e[21]=[x("span",null,"元",-1)])]),_:1},8,["modelValue"]),s(A,{modelValue:o.value.date,"onUpdate:modelValue":e[6]||(e[6]=i=>o.value.date=i),"is-link":"",readonly:"",label:"日期",placeholder:"选择日期",onClick:e[7]||(e[7]=i=>h.value=!0)},null,8,["modelValue"]),s(A,{label:"标签"},{input:f(()=>[x("div",ca,[($(!0),E(ae,null,oe(r.value,i=>($(),G(Ge,{key:i.id,type:o.value.tagIds.includes(i.id)?"primary":"default",color:o.value.tagIds.includes(i.id)?i.color:"",size:"medium",onClick:R=>Ie(i.id)},{default:f(()=>[F(Y(i.name),1)]),_:2},1032,["type","color","onClick"]))),128))])]),_:1}),s(A,{modelValue:o.value.note,"onUpdate:modelValue":e[8]||(e[8]=i=>o.value.note=i),label:"备注",placeholder:"请输入备注（可选）",rows:"2",autosize:"",type:"textarea"},null,8,["modelValue"])]),_:1})])]),_:1},8,["show"]),s(fe,{show:h.value,"onUpdate:show":e[12]||(e[12]=i=>h.value=i),position:"bottom",round:""},{default:f(()=>[s(Ke,{modelValue:C.value,"onUpdate:modelValue":e[10]||(e[10]=i=>C.value=i),title:"选择日期","min-date":_e(D),"max-date":_e(I),onConfirm:$e,onCancel:e[11]||(e[11]=i=>h.value=!1)},null,8,["modelValue","min-date","max-date"])]),_:1},8,["show"]),s(Je,{show:S.value,"onUpdate:show":e[13]||(e[13]=i=>S.value=i),title:"确认删除","show-cancel-button":"",onConfirm:Ee},{default:f(()=>[...e[22]||(e[22]=[x("p",{style:{"text-align":"center",padding:"20px"}},"确定要删除这条记账吗？",-1)])]),_:1},8,["show"])])}}},wa=yt(va,[["__scopeId","data-v-99279592"]]);export{wa as default};
