import{i as F,d as J,k as x,n as P,aG as G,c as t,ac as X,z as $,C as K,J as q,K as o,L as n,I as H,r as f,f as h,V as Q}from"./index-Benjlr5I.js";import{L as O,_ as W,b as Y,c as Z,C as ee,e as te,O as le,N as ae}from"./_plugin-vue_export-helper-CSfwAwDO.js";import{a as L,b as C,D as oe}from"./index-BgStsiB7.js";import"./index-BNpv-Ijv.js";const[ne,T]=F("switch"),se={size:P,loading:Boolean,disabled:Boolean,modelValue:x,activeColor:String,inactiveColor:String,activeValue:{type:x,default:!0},inactiveValue:{type:x,default:!1}};var re=J({name:ne,props:se,emits:["change","update:modelValue"],setup(s,{emit:c,slots:u}){const g=()=>s.modelValue===s.activeValue,v=()=>{if(!s.disabled&&!s.loading){const i=g()?s.inactiveValue:s.activeValue;c("update:modelValue",i),c("change",i)}},y=()=>{if(s.loading){const i=g()?s.activeColor:s.inactiveColor;return t(O,{class:T("loading"),color:i},null)}if(u.node)return u.node()};return G(()=>s.modelValue),()=>{var i;const{size:r,loading:w,disabled:k,activeColor:S,inactiveColor:V}=s,_=g(),I={fontSize:X(r),backgroundColor:_?S:V};return t("div",{role:"switch",class:T({on:_,loading:w,disabled:k}),style:I,tabindex:k?void 0:0,"aria-checked":_,onClick:v},[t("div",{class:T("node")},[y()]),(i=u.background)==null?void 0:i.call(u)])}}});const ie=$(re),ce={class:"settings-page"},ue={__name:"Settings",setup(s){const c=Y(),u=Z(),g=f(null),v=f(!1),y=f(!1),i=f(!1),r=f(null),w=f(!1),k=f(!0),S=h(()=>c.records.length),V=h(()=>u.tags.length),_=h(()=>c.records.filter(a=>a.type==="expense").reduce((a,e)=>a+e.amount,0)),I=h(()=>c.records.filter(a=>a.type==="income").reduce((a,e)=>a+e.amount,0)),N=()=>{v.value=!0;try{const a={version:"1.0.0",exportTime:new Date().toISOString(),records:c.records,tags:u.tags},e=JSON.stringify(a,null,2),p=new Blob([e],{type:"application/json"}),d=URL.createObjectURL(p),l=document.createElement("a");l.href=d,l.download=`money-tracker-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(d),L("导出成功")}catch(a){console.error("导出失败:",a),C("导出失败")}finally{v.value=!1}},U=()=>{g.value?.click()},M=a=>{const e=a.target.files?.[0];if(!e)return;const p=new FileReader;p.onload=d=>{try{const l=JSON.parse(d.target.result);if(!l.records||!Array.isArray(l.records)){C("无效的数据文件");return}r.value=l,i.value=!0}catch(l){console.error("解析文件失败:",l),C("解析文件失败")}},p.readAsText(e),a.target.value=""},B=async a=>{if(a!=="confirm")return r.value=null,!0;if(!r.value)return!0;v.value=!0;try{return r.value.tags&&Array.isArray(r.value.tags)&&await u.importData(r.value.tags),r.value.records&&Array.isArray(r.value.records)&&await c.importData(r.value.records),L("导入成功"),r.value=null,!0}catch(e){return console.error("导入失败:",e),C("导入失败"),!1}finally{v.value=!1}},R=async a=>{if(a!=="confirm")return!0;v.value=!0;try{return await c.clearAll(),await u.clearAll(),L("数据已清空"),!0}catch(e){return console.error("清空失败:",e),C("清空失败"),!1}finally{v.value=!1}},j=a=>{a?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("darkMode",a)};return K(async()=>{await Promise.all([c.init(),u.init()]);const a=localStorage.getItem("darkMode")==="true";w.value=a,a&&document.documentElement.classList.add("dark")}),(a,e)=>{const p=ae,d=H,l=ee,b=te,A=ie,D=oe,z=O,E=le;return Q(),q("div",ce,[t(p,{title:"设置"}),t(b,{inset:"",title:"数据管理"},{default:o(()=>[t(l,{title:"导出数据","is-link":"",onClick:N},{icon:o(()=>[t(d,{name:"down",class:"cell-icon"})]),label:o(()=>[...e[5]||(e[5]=[n("span",{class:"cell-label"},"导出JSON格式文件，可用于备份",-1)])]),_:1}),t(l,{title:"导入数据","is-link":"",onClick:U},{icon:o(()=>[t(d,{name:"upgrade",class:"cell-icon"})]),label:o(()=>[...e[6]||(e[6]=[n("span",{class:"cell-label"},"从JSON文件恢复数据",-1)])]),_:1}),n("input",{ref_key:"fileInput",ref:g,type:"file",accept:".json",style:{display:"none"},onChange:M},null,544),t(l,{title:"清空所有数据","is-link":"",onClick:e[0]||(e[0]=m=>y.value=!0)},{icon:o(()=>[t(d,{name:"delete-o",class:"cell-icon danger"})]),label:o(()=>[...e[7]||(e[7]=[n("span",{class:"cell-label danger"},"删除所有记账和标签数据",-1)])]),_:1})]),_:1}),t(b,{inset:"",title:"显示设置"},{default:o(()=>[t(l,{title:"暗色模式"},{icon:o(()=>[t(d,{name:"eye-o",class:"cell-icon"})]),"right-icon":o(()=>[t(A,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=m=>w.value=m),size:"24",onChange:j},null,8,["modelValue"])]),_:1}),t(l,{title:"累计数据统计"},{icon:o(()=>[t(d,{name:"chart-trending-o",class:"cell-icon"})]),"right-icon":o(()=>[t(A,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=m=>k.value=m),size:"24"},null,8,["modelValue"])]),_:1})]),_:1}),t(b,{inset:"",title:"数据统计"},{default:o(()=>[t(l,{title:"总记账数",value:S.value+" 笔"},null,8,["value"]),t(l,{title:"总支出",value:"¥"+_.value.toFixed(2)},null,8,["value"]),t(l,{title:"总收入",value:"¥"+I.value.toFixed(2)},null,8,["value"]),t(l,{title:"标签数量",value:V.value+" 个"},null,8,["value"]),t(l,{title:"数据存储位置",value:"浏览器本地"})]),_:1}),t(b,{inset:"",title:"关于"},{default:o(()=>[t(l,{title:"应用名称",value:"Money Tracker"}),t(l,{title:"版本号",value:"1.0.0"}),t(l,{title:"作者",value:"Tianyu Xie"}),t(l,{title:"技术栈",value:"Vue 3 + Vant + Pinia"}),t(l,{title:"项目地址","is-link":"",url:"https://github.com"})]),_:1}),e[10]||(e[10]=n("div",{class:"footer"},[n("p",null,"Money Tracker v1.0.0"),n("p",{class:"copyright"},"© 2026 Tianyu Xie. All rights reserved.")],-1)),t(D,{show:y.value,"onUpdate:show":e[3]||(e[3]=m=>y.value=m),title:"确认清空","show-cancel-button":"","before-close":R},{default:o(()=>[...e[8]||(e[8]=[n("div",{class:"confirm-content"},[n("p",null,"确定要清空所有数据吗？"),n("p",{class:"warning"},"此操作不可恢复！"),n("p",{class:"hint"},"建议先导出数据备份")],-1)])]),_:1},8,["show"]),t(D,{show:i.value,"onUpdate:show":e[4]||(e[4]=m=>i.value=m),title:"确认导入","show-cancel-button":"","before-close":B},{default:o(()=>[...e[9]||(e[9]=[n("div",{class:"confirm-content"},[n("p",null,"确定要导入数据吗？"),n("p",{class:"warning"},"当前数据将被覆盖！"),n("p",{class:"hint"},"建议先导出当前数据备份")],-1)])]),_:1},8,["show"]),t(E,{show:v.value,class:"loading-overlay"},{default:o(()=>[t(z,{type:"spinner",color:"#1989fa"})]),_:1},8,["show"])])}}},ge=W(ue,[["__scopeId","data-v-ca709c81"]]);export{ge as default};
