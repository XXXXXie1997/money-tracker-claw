import{d as te,c as t,x as ne,al as ae,I as H,H as oe,a4 as le,t as I,m as se,y as ie,i as ce,D as re,z as ue,C as de,J as k,K as n,O as b,Q as P,R as V,L as u,U as pe,M as U,P as $,S as M,r as h,f as K,V as c,W as N,N as me}from"./index-Benjlr5I.js";import{B as ve,s as J,a as E,D as _e}from"./index-BgStsiB7.js";import{P as fe,p as ge,L as Q,f as ke,_ as ye,c as Ce,b as be,e as he,N as xe,C as we}from"./_plugin-vue_export-helper-CSfwAwDO.js";import{F as Te,R as Se,a as Pe,S as Ue}from"./index-B7ULETM9.js";import"./use-id-BsUR0Dcz.js";const[$e,d]=ce("action-sheet"),Ae=le({},ge,{title:String,round:I,actions:ie(),closeIcon:se("cross"),closeable:I,cancelText:String,description:String,closeOnPopstate:I,closeOnClickAction:Boolean,safeAreaInsetBottom:I}),Be=[...ke,"round","closeOnPopstate","safeAreaInsetBottom"];var De=te({name:$e,props:Ae,emits:["select","cancel","update:show"],setup(r,{slots:l,emit:f}){const m=o=>f("update:show",o),x=()=>{m(!1),f("cancel")},p=()=>{if(r.title)return t("div",{class:d("header")},[r.title,r.closeable&&t(H,{name:r.closeIcon,class:[d("close"),oe],onClick:x},null)])},y=()=>{if(l.cancel||r.cancelText)return[t("div",{class:d("gap")},null),t("button",{type:"button",class:d("cancel"),onClick:x},[l.cancel?l.cancel():r.cancelText])]},T=o=>{if(o.icon)return t(H,{class:d("item-icon"),name:o.icon},null)},S=(o,w)=>o.loading?t(Q,{class:d("loading-icon")},null):l.action?l.action({action:o,index:w}):[t("span",{class:d("name")},[o.name]),o.subname&&t("div",{class:d("subname")},[o.subname])],i=(o,w)=>{const{color:z,loading:v,callback:A,disabled:C,className:W}=o,B=()=>{C||v||(A&&A(o),r.closeOnClickAction&&m(!1),re(()=>f("select",o,w)))};return t("button",{type:"button",style:{color:z},class:[d("item",{loading:v,disabled:C}),W],onClick:B},[T(o),S(o,w)])},q=()=>{if(r.description||l.description){const o=l.description?l.description():r.description;return t("div",{class:d("description")},[o])}};return()=>t(fe,ne({class:d(),position:"bottom","onUpdate:show":m},ae(r,Be)),{default:()=>{var o;return[p(),q(),t("div",{class:d("content")},[r.actions.map(i),(o=l.default)==null?void 0:o.call(l)]),y()]}})}});const Ie=ue(De),Ve={class:"tags-page"},Ne={key:0,class:"loading-container"},qe={class:"usage-count"},ze={class:"usage-count"},We={class:"usage-count"},Fe={class:"tag-form"},Le={class:"color-picker"},Oe=["onClick"],Re={class:"form-actions"},Ke={style:{"text-align":"center",padding:"20px"}},Ee={__name:"Tags",setup(r){const l=Ce(),f=be(),m=h(!1),x=h(!1),p=h(null),y=h(null),T=h(!1),S=h(!0),i=h({name:"",type:"expense",color:"#1989fa"}),q=l.presetColors,o=K(()=>l.getTagsWithUsage(f).filter(s=>s.type==="expense")),w=K(()=>l.getTagsWithUsage(f).filter(s=>s.type==="income")),z=K(()=>l.getTagsWithUsage(f).filter(s=>s.type==="both")),v=s=>{p.value=s,i.value={name:s.name,type:s.type,color:s.color},m.value=!0},A=async()=>{if(!i.value.name.trim()){J("请输入标签名称");return}T.value=!0;try{const s={name:i.value.name.trim(),type:i.value.type,color:i.value.color};p.value?(await l.updateTag(p.value.id,s),E("更新成功")):(await l.addTag(s),E("添加成功")),B()}catch{J("保存失败")}finally{T.value=!1}},C=s=>{y.value=s,x.value=!0},W=async()=>{y.value&&(await l.deleteTag(y.value.id),E("删除成功"),B(),y.value=null)},B=()=>{m.value=!1,p.value=null,i.value={name:"",type:"expense",color:"#1989fa"}};return de(async()=>{S.value=!0,await Promise.all([l.init(),f.init()]),S.value=!1}),(s,a)=>{const G=H,j=xe,X=Q,F=we,g=ve,L=Ue,D=he,O=Te,R=Pe,Y=Se,Z=Ie,ee=_e;return c(),k("div",Ve,[t(j,{title:"标签管理"},{right:n(()=>[t(G,{name:"plus",size:"20",onClick:a[0]||(a[0]=e=>m.value=!0)})]),_:1}),S.value?(c(),k("div",Ne,[t(X,{size:"24px"},{default:n(()=>[...a[6]||(a[6]=[b("加载中...",-1)])]),_:1})])):(c(),k(P,{key:1},[t(D,{inset:"",title:"支出标签"},{default:n(()=>[(c(!0),k(P,null,V(o.value,e=>(c(),$(L,{key:e.id},{right:n(()=>[t(g,{square:"",type:"primary",text:"编辑",onClick:_=>v(e)},null,8,["onClick"]),t(g,{square:"",type:"danger",text:"删除",onClick:_=>C(e)},null,8,["onClick"])]),default:n(()=>[t(F,{title:e.name,"is-link":"",onClick:_=>v(e)},{icon:n(()=>[u("div",{class:"tag-color",style:N({background:e.color})},null,4)]),value:n(()=>[u("span",qe,U(e.usageCount)+" 次使用",1)]),_:2},1032,["title","onClick"])]),_:2},1024))),128))]),_:1}),t(D,{inset:"",title:"收入标签"},{default:n(()=>[(c(!0),k(P,null,V(w.value,e=>(c(),$(L,{key:e.id},{right:n(()=>[t(g,{square:"",type:"primary",text:"编辑",onClick:_=>v(e)},null,8,["onClick"]),t(g,{square:"",type:"danger",text:"删除",onClick:_=>C(e)},null,8,["onClick"])]),default:n(()=>[t(F,{title:e.name,"is-link":"",onClick:_=>v(e)},{icon:n(()=>[u("div",{class:"tag-color",style:N({background:e.color})},null,4)]),value:n(()=>[u("span",ze,U(e.usageCount)+" 次使用",1)]),_:2},1032,["title","onClick"])]),_:2},1024))),128))]),_:1}),t(D,{inset:"",title:"通用标签"},{default:n(()=>[(c(!0),k(P,null,V(z.value,e=>(c(),$(L,{key:e.id},{right:n(()=>[t(g,{square:"",type:"primary",text:"编辑",onClick:_=>v(e)},null,8,["onClick"]),t(g,{square:"",type:"danger",text:"删除",onClick:_=>C(e)},null,8,["onClick"])]),default:n(()=>[t(F,{title:e.name,"is-link":"",onClick:_=>v(e)},{icon:n(()=>[u("div",{class:"tag-color",style:N({background:e.color})},null,4)]),value:n(()=>[u("span",We,U(e.usageCount)+" 次使用",1)]),_:2},1032,["title","onClick"])]),_:2},1024))),128))]),_:1})],64)),t(Z,{show:m.value,"onUpdate:show":a[4]||(a[4]=e=>m.value=e),title:p.value?"编辑标签":"添加标签"},{default:n(()=>[u("div",Fe,[t(D,{inset:""},{default:n(()=>[t(O,{modelValue:i.value.name,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value.name=e),label:"标签名称",placeholder:"请输入标签名称",rules:[{required:!0,message:"请输入标签名称"}]},null,8,["modelValue"]),t(O,{label:"标签类型"},{input:n(()=>[t(Y,{modelValue:i.value.type,"onUpdate:modelValue":a[2]||(a[2]=e=>i.value.type=e),direction:"horizontal"},{default:n(()=>[t(R,{name:"expense"},{default:n(()=>[...a[7]||(a[7]=[b("支出",-1)])]),_:1}),t(R,{name:"income"},{default:n(()=>[...a[8]||(a[8]=[b("收入",-1)])]),_:1}),t(R,{name:"both"},{default:n(()=>[...a[9]||(a[9]=[b("通用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(O,{label:"标签颜色"},{input:n(()=>[u("div",Le,[(c(!0),k(P,null,V(pe(q),e=>(c(),k("div",{key:e,class:me(["color-item",{active:i.value.color===e}]),style:N({background:e}),onClick:_=>i.value.color=e},[i.value.color===e?(c(),$(G,{key:0,name:"success",color:"white"})):M("",!0)],14,Oe))),128))])]),_:1})]),_:1}),u("div",Re,[t(g,{block:"",type:"primary",loading:T.value,onClick:A},{default:n(()=>[b(U(p.value?"保存修改":"添加标签"),1)]),_:1},8,["loading"]),p.value?(c(),$(g,{key:0,block:"",type:"danger",onClick:a[3]||(a[3]=e=>C(p.value))},{default:n(()=>[...a[10]||(a[10]=[b(" 删除标签 ",-1)])]),_:1})):M("",!0)])])]),_:1},8,["show","title"]),t(ee,{show:x.value,"onUpdate:show":a[5]||(a[5]=e=>x.value=e),title:"确认删除","show-cancel-button":"",onConfirm:W},{default:n(()=>[u("p",Ke,[b(' 确定要删除标签"'+U(y.value?.name)+'"吗？',1),a[11]||(a[11]=u("br",null,null,-1)),a[12]||(a[12]=u("span",{style:{color:"#969799","font-size":"12px"}},"（不会删除已记账的记录）",-1))])]),_:1},8,["show"])])}}},je=ye(Ee,[["__scopeId","data-v-f8932873"]]);export{je as default};
